#include "WPILib.h"

class TaskController
{

	static bool stopAll = false;
	const char* name;
	bool run = false;
	Task *aTask = NULL;
	bool debug = false;
	FUNCPTR myTask = NULL;

public:


	bool init(const char* newname)
	{
		//TODO implement
		FUNCPTR myTask = taskRunner;
		aTask = new Task(newname, myTask);
		name = newname;
		return true;
	}

	bool Start(uint32_t param1)
	{
		aTask->Start(param1);
		return true;
	}

	static bool StopAll()
	{
		//TODO make this work in C somehow don't know pointers well
		stopAll = true;
		return true;
	}

	bool StopRequested()
	{
		return (run == false) || (stopAll == true);
	}

	bool Stop()
	{
		run = false;
		if(aTask->Stop())
		{
			return true;
			if(debug)
			{
				//TODO SmartDashboard::PutBoolean("Running:"+name, false);
			}
		}
		return false;
	}

	bool ConfirmDestruction() //Checks if it is not stopped : Will stop it if not
	{
		if(aTask!=NULL)
		{
			if(!aTask->Verify())
			{
				delete aTask;
				aTask = NULL;
				if(debug){
					SmartDashboard::PutBoolean("Stopped", true);
					SmartDashboard::PutString("State", "Disable Stopped");
				}
				return true;
			}
			else return true;
		}
		else return true;
	}


	FUNCPTR taskRunner(uint32_t param){
		return run(param);
	}
};

